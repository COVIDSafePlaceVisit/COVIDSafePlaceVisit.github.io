(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{wFkS:function(i,t,c){"use strict";c.r(t),c.d(t,"VisitorsListPageModule",(function(){return y}));var e=c("SVse"),o=c("s7LF"),n=c("sZkV"),s=c("iInd"),a=c("pLZG"),l=c("lJxs"),r=c("UXun"),b=c("IzEk"),u=c("vkgz"),d=c("wZ+X"),h=c("8Y7J"),k=c("9Ku7"),p=c("apZm"),v=c("lyr6");function O(i,t){if(1&i){const i=h.Qb();h.Nb(0),h.Pb(1,"ion-fab-button",5),h.Xb("click",(function(){return h.nc(i),h.bc().clickMissionControlNonBlockingSwitchNotificationToastFade()})),h.Lb(2,"ion-icon",6),h.Lb(3,"ion-icon",7),h.Ob(),h.Pb(4,"ion-fab-list",8),h.Pb(5,"ion-fab-button",9),h.Pb(6,"ion-icon",10),h.Xb("click",(function(t){h.nc(i);const c=h.bc();return c.clickBulkCheckOut(t,c.placeUUID)})),h.Ob(),h.Ob(),h.Ob(),h.Mb()}if(2&i){const i=t.ngIf;h.Ab(1),h.hc("disabled",0===i)}}function g(i,t){if(1&i&&(h.Nb(0),h.Pb(1,"ion-label"),h.Pb(2,"h2"),h.sc(3),h.Ob(),h.Pb(4,"h3"),h.Lb(5,"ion-icon",11),h.sc(6),h.Ob(),h.Ob(),h.Mb()),2&i){const i=t.$implicit;h.Ab(3),h.uc(" ",i.place_name," "),h.Ab(3),h.uc(" ",i.visits_aggregate.aggregate.count," visitors ")}}function f(i,t){if(1&i&&(h.Nb(0),h.qc(1,g,7,2,"ng-container",3),h.cc(2,"async"),h.Mb()),2&i){const i=h.bc(2);h.Ab(1),h.hc("ngForOf",h.dc(2,1,i.place))}}function m(i,t){if(1&i&&(h.Pb(0,"ion-list-header"),h.qc(1,f,3,3,"ng-container",2),h.cc(2,"async"),h.Ob()),2&i){const i=h.bc();h.Ab(1),h.hc("ngIf",null!==h.dc(2,1,i.place))}}function C(i,t){if(1&i){const i=h.Qb();h.Pb(0,"ion-item-option",16),h.Xb("click",(function(t){h.nc(i);const c=h.bc().$implicit;return h.bc().clickCheckOut(t,c.visitor.visitor_uuid,c.checked_in_at)})),h.sc(1," Check out "),h.Ob()}}function P(i,t){if(1&i&&(h.Pb(0,"ion-item-sliding"),h.Pb(1,"ion-item-options"),h.qc(2,C,2,0,"ion-item-option",12),h.Ob(),h.Pb(3,"ion-item",13),h.Pb(4,"ion-label",14),h.Pb(5,"span",15),h.sc(6),h.cc(7,"date"),h.cc(8,"date"),h.Ob(),h.Pb(9,"h2"),h.sc(10),h.Ob(),h.Pb(11,"h3"),h.sc(12),h.Ob(),h.Ob(),h.Ob(),h.Ob()),2&i){const i=t.$implicit;h.Ab(2),h.hc("ngIf",!i.checked_out_at),h.Ab(2),h.ic("color",i.checked_out_at?"success":"warning"),h.Ab(2),h.vc(" ",h.ec(7,8,i.checked_in_at,"EEEE HH:mm"),"\u2013",h.ec(8,11,i.checked_out_at,"HH:mm")," "),h.Ab(4),h.vc(" ",i.visitor.visitor_first_name," ",i.visitor.visitor_last_name," "),h.Ab(2),h.vc(" ",i.visitor.visitor_phone," ",i.visitor.visitor_email," ")}}const _=[{path:"",component:(()=>{class i{constructor(i,t,c,e,o){this.activatedRoute=i,this.toastController=t,this.authenticationService=c,this.checkInOutService=e,this.placeAdminService=o,this.missionControlCoverClickedUnlocked=!1,this.placeUUID=i.snapshot.paramMap.get("placeUUID"),console.log("VisitorsListPage -> constructor -> this.placeUUID",this.placeUUID);const n=o.getVisitorsByPlaceUUID(this.placeUUID);this.placeVisitorsResult=n;const s=n.pipe(Object(a.a)(i=>{var t,c;return void 0!==(null===(c=null===(t=i.data)||void 0===t?void 0:t.place)||void 0===c?void 0:c[0])}),Object(l.a)(i=>i.data.place));this.place=s;const b=s.pipe(Object(l.a)(i=>i[0].visits));this.visits=b,this.visitsPendingCheckOut=this.visits.pipe(Object(l.a)(i=>i.filter(i=>Object(d.c)(i.checked_out_at)))),this.countVisitsPendingCheckOut=this.visitsPendingCheckOut.pipe(Object(l.a)(({length:i})=>i),Object(r.a)(1))}ngOnInit(){}clickCheckOut(i,t,c){if(console.log("clickCheckOut -> event",i),void 0===t||void 0===c)return;const e=this.checkInOutService.updateCheckOutVisitor(this.placeUUID,t,c);console.log("VisitorsListPage -> clickCheckOut -> checkedOutObs",e),e.subscribe(({data:i,errors:t,context:c,extensions:e})=>{var o;console.log("clickCheckOut -> data",i,t,c,e);const n=new Date(null===(o=null==i?void 0:i.update_visit_by_pk)||void 0===o?void 0:o.checked_out_at);console.log("VisitorsListPage -> clickCheckOut -> checkedOutDateTime",n)})}getCountPendingCheckoutVisitors(){}filterRemainingPendingCheckOutVisitors(){}clickMissionControlNonBlockingSwitchNotificationToastFade(){this.countVisitsPendingCheckOut.pipe(Object(b.a)(1)).subscribe(i=>{this.missionControlCoverClickedUnlocked=!this.missionControlCoverClickedUnlocked,this.missionControlCoverClickedUnlocked&&this.presentToast(`Are you sure you want to check out remaining ${i} visitors?<br/>(for end of day reconciliation)`,800,"passiveToast")})}clickBulkCheckOut(i,t){this.placeAdminService.updateBulkCheckOut(t).pipe(Object(u.a)(i=>{console.log("bulkCheckOut",i)}),Object(a.a)(i=>{var t,c,e,o;return null!==(null===(c=null===(t=i.data)||void 0===t?void 0:t.update_visit)||void 0===c?void 0:c.affected_rows)&&void 0!==(null===(o=null===(e=i.data)||void 0===e?void 0:e.update_visit)||void 0===o?void 0:o.affected_rows)}),Object(b.a)(1),Object(l.a)(i=>i.data.update_visit),Object(u.a)(i=>{const t=i.affected_rows>0?`Thank you for keeping us a COVIDSafe Place<br/>Successfully checked out ${i.affected_rows} visitors`:"Thank you for keeping us a COVIDSafe Place<br/>Visitors already checked out";console.log("clickBulkCheckOut -> successfulEndOfDayBulkCheckOut",i,t),this.presentToast(t)})).subscribe()}presentToast(i="loading",t=3500,c,e){this.toastController.create({message:i,duration:t,animated:!0,cssClass:c,color:e,translucent:!0}).then(i=>i.present()).then(()=>{console.log("Toast presented "+i)})}}return i.\u0275fac=function(t){return new(t||i)(h.Kb(s.a),h.Kb(n.J),h.Kb(k.a),h.Kb(p.a),h.Kb(v.a))},i.\u0275cmp=h.Eb({type:i,selectors:[["app-visitors-list"]],decls:18,vars:17,consts:[["color","cobaltblue"],["horizontal","start","vertical","bottom","slot","fixed","size","large"],[4,"ngIf"],[4,"ngFor","ngForOf"],["color","light","hidden",""],["color","cobaltbluemonochrome",3,"disabled","click"],["name","list-outline","size","large"],["name","log-out-outline","size","small"],["side","end"],["color","warning"],["name","log-out-outline","color","","size","large",3,"click"],["name","people"],["color","success","button","",3,"click",4,"ngIf"],["button",""],[3,"color"],[2,"float","right"],["color","success","button","",3,"click"]],template:function(i,t){1&i&&(h.Pb(0,"ion-header"),h.Pb(1,"ion-toolbar",0),h.Pb(2,"ion-title"),h.sc(3," List COVIDSafe check ins \u2705 | Place visitors "),h.Ob(),h.Ob(),h.Ob(),h.Pb(4,"ion-fab",1),h.qc(5,O,7,1,"ng-container",2),h.cc(6,"async"),h.Ob(),h.Pb(7,"ion-content"),h.Pb(8,"ion-list"),h.qc(9,m,3,3,"ion-list-header",2),h.qc(10,P,13,14,"ion-item-sliding",3),h.cc(11,"async"),h.Ob(),h.Pb(12,"ion-text",4),h.sc(13),h.cc(14,"json"),h.cc(15,"async"),h.cc(16,"json"),h.cc(17,"async"),h.Ob(),h.Ob()),2&i&&(h.Ab(5),h.hc("ngIf",h.dc(6,5,t.countVisitsPendingCheckOut)),h.Ab(4),h.hc("ngIf",t.place),h.Ab(1),h.hc("ngForOf",h.dc(11,7,t.visits)),h.Ab(3),h.vc(" 1 ",h.dc(14,9,h.dc(15,11,t.place))," 2 ",h.dc(16,13,h.dc(17,15,t.visits))," "))},directives:[n.n,n.C,n.B,n.j,e.m,n.i,n.w,e.l,n.A,n.k,n.o,n.l,n.x,n.v,n.u,n.t,n.q,n.s],pipes:[e.b,e.g,e.e],styles:["ion-icon[_ngcontent-%COMP%]{vertical-align:middle}"]}),i})()}];let I=(()=>{class i{}return i.\u0275mod=h.Ib({type:i}),i.\u0275inj=h.Hb({factory:function(t){return new(t||i)},imports:[[s.i.forChild(_)],s.i]}),i})(),y=(()=>{class i{}return i.\u0275mod=h.Ib({type:i}),i.\u0275inj=h.Hb({factory:function(t){return new(t||i)},imports:[[e.c,o.g,n.D,I]]}),i})()}}]);