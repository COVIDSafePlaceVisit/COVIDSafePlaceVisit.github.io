!function(){function i(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function t(i,t){for(var c=0;c<t.length;c++){var e=t[c];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{wFkS:function(c,e,n){"use strict";n.r(e),n.d(e,"VisitorsListPageModule",(function(){return V}));var o=n("SVse"),s=n("s7LF"),a=n("sZkV"),l=n("iInd"),r=n("pLZG"),u=n("lJxs"),b=n("UXun"),d=n("IzEk"),v=n("vkgz"),h=n("wZ+X"),f=n("8Y7J"),k=n("9Ku7"),p=n("apZm"),g=n("lyr6");function O(i,t){if(1&i){var c=f.Qb();f.Nb(0),f.Pb(1,"ion-fab-button",5),f.Xb("click",(function(){return f.nc(c),f.bc().clickMissionControlNonBlockingSwitchNotificationToastFade()})),f.Lb(2,"ion-icon",6),f.Lb(3,"ion-icon",7),f.Ob(),f.Pb(4,"ion-fab-list",8),f.Pb(5,"ion-fab-button",9),f.Pb(6,"ion-icon",10),f.Xb("click",(function(i){f.nc(c);var t=f.bc();return t.clickBulkCheckOut(i,t.placeUUID)})),f.Ob(),f.Ob(),f.Ob(),f.Mb()}if(2&i){var e=t.ngIf;f.Ab(1),f.hc("disabled",0===e)}}function m(i,t){if(1&i&&(f.Nb(0),f.Pb(1,"ion-label"),f.Pb(2,"h2"),f.sc(3),f.Ob(),f.Pb(4,"h3"),f.Lb(5,"ion-icon",11),f.sc(6),f.Ob(),f.Ob(),f.Mb()),2&i){var c=t.$implicit;f.Ab(3),f.uc(" ",c.place_name," "),f.Ab(3),f.uc(" ",c.visits_aggregate.aggregate.count," visitors ")}}function C(i,t){if(1&i&&(f.Nb(0),f.qc(1,m,7,2,"ng-container",3),f.cc(2,"async"),f.Mb()),2&i){var c=f.bc(2);f.Ab(1),f.hc("ngForOf",f.dc(2,1,c.place))}}function P(i,t){if(1&i&&(f.Pb(0,"ion-list-header"),f.qc(1,C,3,3,"ng-container",2),f.cc(2,"async"),f.Ob()),2&i){var c=f.bc();f.Ab(1),f.hc("ngIf",null!==f.dc(2,1,c.place))}}function y(i,t){if(1&i){var c=f.Qb();f.Pb(0,"ion-item-option",16),f.Xb("click",(function(i){f.nc(c);var t=f.bc().$implicit;return f.bc().clickCheckOut(i,t.visitor.visitor_uuid,t.checked_in_at)})),f.sc(1," Check out "),f.Ob()}}function _(i,t){if(1&i&&(f.Pb(0,"ion-item-sliding"),f.Pb(1,"ion-item-options"),f.qc(2,y,2,0,"ion-item-option",12),f.Ob(),f.Pb(3,"ion-item",13),f.Pb(4,"ion-label",14),f.Pb(5,"span",15),f.sc(6),f.cc(7,"date"),f.cc(8,"date"),f.Ob(),f.Pb(9,"h2"),f.sc(10),f.Ob(),f.Pb(11,"h3"),f.sc(12),f.Ob(),f.Ob(),f.Ob(),f.Ob()),2&i){var c=t.$implicit;f.Ab(2),f.hc("ngIf",!c.checked_out_at),f.Ab(2),f.ic("color",c.checked_out_at?"success":"warning"),f.Ab(2),f.vc(" ",f.ec(7,8,c.checked_in_at,"EEEE HH:mm"),"\u2013",f.ec(8,11,c.checked_out_at,"HH:mm")," "),f.Ab(4),f.vc(" ",c.visitor.visitor_first_name," ",c.visitor.visitor_last_name," "),f.Ab(2),f.vc(" ",c.visitor.visitor_phone," ",c.visitor.visitor_email," ")}}var w,I,U,j=[{path:"",component:(w=function(){function c(t,e,n,o,s){i(this,c),this.activatedRoute=t,this.toastController=e,this.authenticationService=n,this.checkInOutService=o,this.placeAdminService=s,this.missionControlCoverClickedUnlocked=!1,this.placeUUID=t.snapshot.paramMap.get("placeUUID"),console.log("VisitorsListPage -> constructor -> this.placeUUID",this.placeUUID);var a=s.getVisitorsByPlaceUUID(this.placeUUID);this.placeVisitorsResult=a;var l=a.pipe(Object(r.a)((function(i){var t,c;return void 0!==(null===(c=null===(t=i.data)||void 0===t?void 0:t.place)||void 0===c?void 0:c[0])})),Object(u.a)((function(i){return i.data.place})));this.place=l;var d=l.pipe(Object(u.a)((function(i){return i[0].visits})));this.visits=d,this.visitsPendingCheckOut=this.visits.pipe(Object(u.a)((function(i){return i.filter((function(i){return Object(h.c)(i.checked_out_at)}))}))),this.countVisitsPendingCheckOut=this.visitsPendingCheckOut.pipe(Object(u.a)((function(i){return i.length})),Object(b.a)(1))}var e,n,o;return e=c,(n=[{key:"ngOnInit",value:function(){}},{key:"clickCheckOut",value:function(i,t,c){if(console.log("clickCheckOut -> event",i),void 0!==t&&void 0!==c){var e=this.checkInOutService.updateCheckOutVisitor(this.placeUUID,t,c);console.log("VisitorsListPage -> clickCheckOut -> checkedOutObs",e),e.subscribe((function(i){var t,c=i.data,e=i.errors,n=i.context,o=i.extensions;console.log("clickCheckOut -> data",c,e,n,o);var s=new Date(null===(t=null==c?void 0:c.update_visit_by_pk)||void 0===t?void 0:t.checked_out_at);console.log("VisitorsListPage -> clickCheckOut -> checkedOutDateTime",s)}))}}},{key:"getCountPendingCheckoutVisitors",value:function(){}},{key:"filterRemainingPendingCheckOutVisitors",value:function(){}},{key:"clickMissionControlNonBlockingSwitchNotificationToastFade",value:function(){var i=this;this.countVisitsPendingCheckOut.pipe(Object(d.a)(1)).subscribe((function(t){i.missionControlCoverClickedUnlocked=!i.missionControlCoverClickedUnlocked,i.missionControlCoverClickedUnlocked&&i.presentToast("Are you sure you want to check out remaining ".concat(t," visitors?<br/>(for end of day reconciliation)"),800,"passiveToast")}))}},{key:"clickBulkCheckOut",value:function(i,t){var c=this;this.placeAdminService.updateBulkCheckOut(t).pipe(Object(v.a)((function(i){console.log("bulkCheckOut",i)})),Object(r.a)((function(i){var t,c,e,n;return null!==(null===(c=null===(t=i.data)||void 0===t?void 0:t.update_visit)||void 0===c?void 0:c.affected_rows)&&void 0!==(null===(n=null===(e=i.data)||void 0===e?void 0:e.update_visit)||void 0===n?void 0:n.affected_rows)})),Object(d.a)(1),Object(u.a)((function(i){return i.data.update_visit})),Object(v.a)((function(i){var t=i.affected_rows>0?"Thank you for keeping us a COVIDSafe Place<br/>Successfully checked out ".concat(i.affected_rows," visitors"):"Thank you for keeping us a COVIDSafe Place<br/>Visitors already checked out";console.log("clickBulkCheckOut -> successfulEndOfDayBulkCheckOut",i,t),c.presentToast(t)}))).subscribe()}},{key:"presentToast",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"loading",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3500,c=arguments.length>2?arguments[2]:void 0,e=arguments.length>3?arguments[3]:void 0;this.toastController.create({message:i,duration:t,animated:!0,cssClass:c,color:e,translucent:!0}).then((function(i){return i.present()})).then((function(){console.log("Toast presented "+i)}))}}])&&t(e.prototype,n),o&&t(e,o),c}(),w.\u0275fac=function(i){return new(i||w)(f.Kb(l.a),f.Kb(a.J),f.Kb(k.a),f.Kb(p.a),f.Kb(g.a))},w.\u0275cmp=f.Eb({type:w,selectors:[["app-visitors-list"]],decls:18,vars:17,consts:[["color","cobaltblue"],["horizontal","start","vertical","bottom","slot","fixed","size","large"],[4,"ngIf"],[4,"ngFor","ngForOf"],["color","light","hidden",""],["color","cobaltbluemonochrome",3,"disabled","click"],["name","list-outline","size","large"],["name","log-out-outline","size","small"],["side","end"],["color","warning"],["name","log-out-outline","color","","size","large",3,"click"],["name","people"],["color","success","button","",3,"click",4,"ngIf"],["button",""],[3,"color"],[2,"float","right"],["color","success","button","",3,"click"]],template:function(i,t){1&i&&(f.Pb(0,"ion-header"),f.Pb(1,"ion-toolbar",0),f.Pb(2,"ion-title"),f.sc(3," List COVIDSafe check ins \u2705 | Place visitors "),f.Ob(),f.Ob(),f.Ob(),f.Pb(4,"ion-fab",1),f.qc(5,O,7,1,"ng-container",2),f.cc(6,"async"),f.Ob(),f.Pb(7,"ion-content"),f.Pb(8,"ion-list"),f.qc(9,P,3,3,"ion-list-header",2),f.qc(10,_,13,14,"ion-item-sliding",3),f.cc(11,"async"),f.Ob(),f.Pb(12,"ion-text",4),f.sc(13),f.cc(14,"json"),f.cc(15,"async"),f.cc(16,"json"),f.cc(17,"async"),f.Ob(),f.Ob()),2&i&&(f.Ab(5),f.hc("ngIf",f.dc(6,5,t.countVisitsPendingCheckOut)),f.Ab(4),f.hc("ngIf",t.place),f.Ab(1),f.hc("ngForOf",f.dc(11,7,t.visits)),f.Ab(3),f.vc(" 1 ",f.dc(14,9,f.dc(15,11,t.place))," 2 ",f.dc(16,13,f.dc(17,15,t.visits))," "))},directives:[a.n,a.C,a.B,a.j,o.m,a.i,a.w,o.l,a.A,a.k,a.o,a.l,a.x,a.v,a.u,a.t,a.q,a.s],pipes:[o.b,o.g,o.e],styles:["ion-icon[_ngcontent-%COMP%]{vertical-align:middle}"]}),w)}],A=((U=function t(){i(this,t)}).\u0275mod=f.Ib({type:U}),U.\u0275inj=f.Hb({factory:function(i){return new(i||U)},imports:[[l.i.forChild(j)],l.i]}),U),V=((I=function t(){i(this,t)}).\u0275mod=f.Ib({type:I}),I.\u0275inj=f.Hb({factory:function(i){return new(i||I)},imports:[[o.c,s.g,a.D,A]]}),I)}}])}();