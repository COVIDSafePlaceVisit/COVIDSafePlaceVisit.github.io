!function(){function t(e,i,n){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(e,i,n||e)}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function n(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=c(t);if(e){var r=c(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return o(this,i)}}function o(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{wFkS:function(i,o,s){"use strict";s.r(o),s.d(o,"VisitorsListPageModule",(function(){return Q}));var u=s("SVse"),l=s("s7LF"),f=s("sZkV"),b=s("iInd"),h=s("z6cu"),d=s("JIr8"),v=s("lJxs"),p=s("vkgz"),g=s("XNiG"),k=s("zx2A"),O=function(){function t(e,i){r(this,t),this.notifier=e,this.source=i}return a(t,[{key:"call",value:function(t,e){return e.subscribe(new y(t,this.notifier,this.source))}}]),t}(),y=function(i){e(s,i);var o=n(s);function s(t,e,i){var n;return r(this,s),(n=o.call(this,t)).notifier=e,n.source=i,n}return a(s,[{key:"error",value:function(e){if(!this.isStopped){var i=this.errors,n=this.retries,o=this.retriesSubscription;if(n)this.errors=void 0,this.retriesSubscription=void 0;else{i=new g.a;try{n=(0,this.notifier)(i)}catch(r){return t(c(s.prototype),"error",this).call(this,r)}o=Object(k.c)(n,new k.a(this))}this._unsubscribeAndRecycle(),this.errors=i,this.retries=n,this.retriesSubscription=o,i.next(e)}}},{key:"_unsubscribe",value:function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0}},{key:"notifyNext",value:function(){var t=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=t,this.source.subscribe(this)}}]),s}(k.b),m=s("D0XW"),P=s("7o/Q"),_=s("WMd4"),C=function(){function t(e,i){r(this,t),this.delay=e,this.scheduler=i}return a(t,[{key:"call",value:function(t,e){return e.subscribe(new w(t,this.delay,this.scheduler))}}]),t}(),w=function(t){e(o,t);var i=n(o);function o(t,e,n){var c;return r(this,o),(c=i.call(this,t)).delay=e,c.scheduler=n,c.queue=[],c.active=!1,c.errored=!1,c}return a(o,[{key:"_schedule",value:function(t){this.active=!0,this.destination.add(t.schedule(o.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}},{key:"scheduleNotification",value:function(t){if(!0!==this.errored){var e=this.scheduler,i=new j(e.now()+this.delay,t);this.queue.push(i),!1===this.active&&this._schedule(e)}}},{key:"_next",value:function(t){this.scheduleNotification(_.a.createNext(t))}},{key:"_error",value:function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}},{key:"_complete",value:function(){this.scheduleNotification(_.a.createComplete()),this.unsubscribe()}}],[{key:"dispatch",value:function(t){for(var e=t.source,i=e.queue,n=t.scheduler,o=t.destination;i.length>0&&i[0].time-n.now()<=0;)i.shift().notification.observe(o);if(i.length>0){var c=Math.max(0,i[0].time-n.now());this.schedule(t,c)}else this.unsubscribe(),e.active=!1}}]),o}(P.a),j=function t(e,i){r(this,t),this.time=e,this.notification=i},I=s("eIep"),V=s("IzEk"),U=s("pLZG"),A=s("nYR2"),S=s("UXun"),D=s("wZ+X"),R=s("8Y7J"),L=s("9Ku7"),x=s("apZm"),N=s("lyr6");function T(t,e){if(1&t&&(R.Pb(0,"ion-text",6),R.sc(1),R.cc(2,"json"),R.Ob()),2&t){var i=R.bc();R.Ab(1),R.uc(" ",R.dc(2,1,i.errors),"\n")}}function q(t,e){if(1&t){var i=R.Qb();R.Nb(0),R.Pb(1,"ion-fab-button",7),R.Xb("click",(function(){return R.nc(i),R.bc().clickMissionControlNonBlockingSwitchNotificationToastFade()})),R.Lb(2,"ion-icon",8),R.Lb(3,"ion-icon",9),R.Ob(),R.Pb(4,"ion-fab-list",10),R.Pb(5,"ion-fab-button",11),R.Pb(6,"ion-icon",12),R.Xb("click",(function(t){R.nc(i);var e=R.bc();return e.clickBulkCheckOut(t,e.placeUUID)})),R.Ob(),R.Ob(),R.Ob(),R.Mb()}if(2&t){var n=e.ngIf;R.Ab(1),R.hc("disabled",0===n)}}function E(t,e){if(1&t&&(R.Nb(0),R.Pb(1,"ion-label"),R.Pb(2,"h2"),R.sc(3),R.Ob(),R.Pb(4,"h3"),R.Lb(5,"ion-icon",13),R.sc(6),R.Ob(),R.Ob(),R.Mb()),2&t){var i=e.$implicit;R.Ab(3),R.uc(" ",i.place_name," "),R.Ab(3),R.uc(" ",i.visits_aggregate.aggregate.count," visitors ")}}function B(t,e){if(1&t&&(R.Nb(0),R.qc(1,E,7,2,"ng-container",4),R.cc(2,"async"),R.Mb()),2&t){var i=R.bc(2);R.Ab(1),R.hc("ngForOf",R.dc(2,1,i.place))}}function M(t,e){if(1&t&&(R.Pb(0,"ion-list-header"),R.qc(1,B,3,3,"ng-container",3),R.cc(2,"async"),R.Ob()),2&t){var i=R.bc();R.Ab(1),R.hc("ngIf",null!==R.dc(2,1,i.place))}}function z(t,e){if(1&t){var i=R.Qb();R.Pb(0,"ion-item-option",18),R.Xb("click",(function(t){R.nc(i);var e=R.bc().$implicit;return R.bc().clickCheckOut(t,e.visitor.visitor_uuid,e.checked_in_at)})),R.sc(1," Check out "),R.Ob()}}function F(t,e){if(1&t&&(R.Pb(0,"ion-item-sliding"),R.Pb(1,"ion-item-options"),R.qc(2,z,2,0,"ion-item-option",14),R.Ob(),R.Pb(3,"ion-item",15),R.Pb(4,"ion-label",16),R.Pb(5,"span",17),R.sc(6),R.cc(7,"date"),R.cc(8,"date"),R.Ob(),R.Pb(9,"h2"),R.sc(10),R.Ob(),R.Pb(11,"h3"),R.sc(12),R.Ob(),R.Ob(),R.Ob(),R.Ob()),2&t){var i=e.$implicit;R.Ab(2),R.hc("ngIf",!i.checked_out_at),R.Ab(2),R.ic("color",i.checked_out_at?"success":"warning"),R.Ab(2),R.vc(" ",R.ec(7,8,i.checked_in_at,"EEEE HH:mm"),"\u2013",R.ec(8,11,i.checked_out_at,"HH:mm")," "),R.Ab(4),R.vc(" ",i.visitor.visitor_first_name," ",i.visitor.visitor_last_name," "),R.Ab(2),R.vc(" ",i.visitor.visitor_phone," ",i.visitor.visitor_email," ")}}var H,K,X,J=[{path:"",component:(H=function(){function t(e,i,n,o,c,s){var a=this;r(this,t),this.activatedRoute=e,this.router=i,this.toastController=n,this.authenticationService=o,this.checkInOutService=c,this.placeAdminService=s,this.missionControlCoverClickedUnlocked=!1,this.errors=[],this.placeUUID=e.snapshot.paramMap.get("placeUUID"),console.log("VisitorsListPage -> constructor -> this.placeUUID",this.placeUUID);var u=s.getVisitorsByPlaceUUID(this.placeUUID);this.placeVisitorsResult=u;var l,f=u.pipe(Object(d.a)((function(t,e){var i;console.error("VisitorsListPage -> err",t),console.error("VisitorsListPage -> caught",e);var n=t;console.error("VisitorsListPage -> apolloError",n);var o=null===(i=n.extensions)||void 0===i?void 0:i.code;return a.presentToast("Real-time subscription out of sync. Authorisation expired; Please try refreshing or signing in again to administrate your COVIDSafe registry. <br/> ".concat(o,"<br/> Reloading soon")),Object(h.a)(t)})),Object(v.a)((function(t){return console.log("VisitorsListPage -> interceptResult",t),t})),Object(p.a)((function(t){console.log("VisitorsListPage -> placeVisitorsResult",t)})),(l=function(t){return console.log("VisitorsListPage -> retryWhen errors",t),t.pipe(function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.a,n=(e=t)instanceof Date&&!isNaN(+e)?+t-i.now():Math.abs(t);return function(t){return t.lift(new C(n,i))}}(5e3),Object(p.a)((function(t){console.log("VisitorsListPage -> triggerSideEffectBigRefresh",t),location.reload()})),Object(I.a)((function(t){return s.getVisitorsByPlaceUUID(a.placeUUID)})),Object(V.a)(2),Object(p.a)((function(t){})))},function(t){return t.lift(new O(l,t))}),Object(p.a)((function(t){var e;0===(null===(e=t.data)||void 0===e?void 0:e.place.length)&&(a.presentToast("No places found. Have you activated the correct Place link? <br/>Check account setup or email info@singletouchdigital.com.au to find out more"),a.router.navigate(["sign-in"]))})),Object(U.a)((function(t){var e,i;return void 0!==(null===(i=null===(e=t.data)||void 0===e?void 0:e.place)||void 0===i?void 0:i[0])})),Object(v.a)((function(t){return t.data.place})),Object(p.a)((function(t){console.log("VisitorsListPage -> greatSuccess",t)})),Object(A.a)((function(){console.log("VisitorsListPage -> completed")})));this.place=f;var b=f.pipe(Object(v.a)((function(t){return t[0].visits})));this.visits=b,this.visitsPendingCheckOut=this.visits.pipe(Object(v.a)((function(t){return t.filter((function(t){return Object(D.c)(t.checked_out_at)}))}))),this.countVisitsPendingCheckOut=this.visitsPendingCheckOut.pipe(Object(v.a)((function(t){return t.length})),Object(S.a)(1))}return a(t,[{key:"ngOnInit",value:function(){}},{key:"clickCheckOut",value:function(t,e,i){if(console.log("clickCheckOut -> event",t),void 0!==e&&void 0!==i){var n=this.checkInOutService.updateCheckOutVisitor(this.placeUUID,e,i);console.log("VisitorsListPage -> clickCheckOut -> checkedOutObs",n),n.subscribe((function(t){var e,i=t.data,n=t.errors,o=t.context,c=t.extensions;console.log("clickCheckOut -> data",i,n,o,c);var r=new Date(null===(e=null==i?void 0:i.update_visit_by_pk)||void 0===e?void 0:e.checked_out_at);console.log("VisitorsListPage -> clickCheckOut -> checkedOutDateTime",r)}))}}},{key:"getCountPendingCheckoutVisitors",value:function(){}},{key:"filterRemainingPendingCheckOutVisitors",value:function(){}},{key:"clickMissionControlNonBlockingSwitchNotificationToastFade",value:function(){var t=this;this.countVisitsPendingCheckOut.pipe(Object(V.a)(1)).subscribe((function(e){t.missionControlCoverClickedUnlocked=!t.missionControlCoverClickedUnlocked,t.missionControlCoverClickedUnlocked&&t.presentToast("Are you sure you want to check out remaining ".concat(e," visitors?<br/>(for end of day reconciliation)"),800,"passiveToast")}))}},{key:"clickBulkCheckOut",value:function(t,e){var i=this;this.placeAdminService.updateBulkCheckOut(e).pipe(Object(p.a)((function(t){console.log("bulkCheckOut",t)})),Object(U.a)((function(t){var e,i,n,o;return null!==(null===(i=null===(e=t.data)||void 0===e?void 0:e.update_visit)||void 0===i?void 0:i.affected_rows)&&void 0!==(null===(o=null===(n=t.data)||void 0===n?void 0:n.update_visit)||void 0===o?void 0:o.affected_rows)})),Object(V.a)(1),Object(v.a)((function(t){return t.data.update_visit})),Object(p.a)((function(t){var e=t.affected_rows>0?"Thank you for keeping us a COVIDSafe Place<br/>Successfully checked out ".concat(t.affected_rows," visitors"):"Thank you for keeping us a COVIDSafe Place<br/>Visitors already checked out";console.log("clickBulkCheckOut -> successfulEndOfDayBulkCheckOut",t,e),i.presentToast(e)}))).subscribe()}},{key:"presentToast",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"loading",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3500,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this.toastController.create({message:t,duration:e,animated:!0,cssClass:i,color:n,translucent:!0}).then((function(t){return t.present()})).then((function(){console.log("Toast presented "+t)}))}}]),t}(),H.\u0275fac=function(t){return new(t||H)(R.Kb(b.a),R.Kb(b.g),R.Kb(f.J),R.Kb(L.a),R.Kb(x.a),R.Kb(N.a))},H.\u0275cmp=R.Eb({type:H,selectors:[["app-visitors-list"]],decls:19,vars:18,consts:[["color","cobaltblue"],["color","danger",4,"ngIf"],["horizontal","start","vertical","bottom","slot","fixed","size","large"],[4,"ngIf"],[4,"ngFor","ngForOf"],["color","light","hidden",""],["color","danger"],["color","cobaltbluemonochrome",3,"disabled","click"],["name","list-outline","size","large"],["name","log-out-outline","size","small"],["side","end"],["color","warning"],["name","log-out-outline","color","","size","large",3,"click"],["name","people"],["color","success","button","",3,"click",4,"ngIf"],["button",""],[3,"color"],[2,"float","right"],["color","success","button","",3,"click"]],template:function(t,e){1&t&&(R.Pb(0,"ion-header"),R.Pb(1,"ion-toolbar",0),R.Pb(2,"ion-title"),R.sc(3," List COVIDSafe check ins \u2705 | Place visitors "),R.Ob(),R.Ob(),R.Ob(),R.qc(4,T,3,3,"ion-text",1),R.Pb(5,"ion-fab",2),R.qc(6,q,7,1,"ng-container",3),R.cc(7,"async"),R.Ob(),R.Pb(8,"ion-content"),R.Pb(9,"ion-list"),R.qc(10,M,3,3,"ion-list-header",3),R.qc(11,F,13,14,"ion-item-sliding",4),R.cc(12,"async"),R.Ob(),R.Pb(13,"ion-text",5),R.sc(14),R.cc(15,"json"),R.cc(16,"async"),R.cc(17,"json"),R.cc(18,"async"),R.Ob(),R.Ob()),2&t&&(R.Ab(4),R.hc("ngIf",e.errors.length>0),R.Ab(2),R.hc("ngIf",R.dc(7,6,e.countVisitsPendingCheckOut)),R.Ab(4),R.hc("ngIf",e.place),R.Ab(1),R.hc("ngForOf",R.dc(12,8,e.visits)),R.Ab(3),R.vc(" 1 ",R.dc(15,10,R.dc(16,12,e.place))," 2 ",R.dc(17,14,R.dc(18,16,e.visits))," "))},directives:[f.n,f.C,f.B,u.m,f.j,f.i,f.w,u.l,f.A,f.k,f.o,f.l,f.x,f.v,f.u,f.t,f.q,f.s],pipes:[u.b,u.g,u.e],styles:["ion-icon[_ngcontent-%COMP%]{vertical-align:middle}"]}),H)}],Z=((X=function t(){r(this,t)}).\u0275mod=R.Ib({type:X}),X.\u0275inj=R.Hb({factory:function(t){return new(t||X)},imports:[[b.i.forChild(J)],b.i]}),X),Q=((K=function t(){r(this,t)}).\u0275mod=R.Ib({type:K}),K.\u0275inj=R.Hb({factory:function(t){return new(t||K)},imports:[[u.c,l.g,f.D,Z]]}),K)}}])}();